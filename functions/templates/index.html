<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스케줄</title>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .calendar-header {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-block;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .calendar-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        #calendar {
            max-width: 100%;
            margin: 0 auto;
        }

        .fc-toolbar {
            margin-bottom: 1.5rem !important;
        }

        .fc-toolbar-title {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #333 !important;
        }

        .fc-button-primary {
            background: #667eea !important;
            border-color: #667eea !important;
            font-weight: 500 !important;
        }

        .fc-button-primary:hover {
            background: #5a67d8 !important;
            border-color: #5a67d8 !important;
        }

        .fc-button-primary:not(:disabled):active,
        .fc-button-primary:not(:disabled).fc-button-active {
            background: #4c51bf !important;
            border-color: #4c51bf !important;
        }

        .fc-event {
            border-radius: 4px !important;
            border: none !important;
            padding: 2px 4px !important;
            font-size: 0.85rem !important;
            cursor: pointer !important;
        }

        .fc-event.own-event {
            background: #667eea !important;
            color: white !important;
        }

        .fc-event.shared-event {
            background: #28a745 !important;
            color: white !important;
        }

        .fc-event.all-event {
            background: #17a2b8 !important;
            color: white !important;
        }

        .fc-daygrid-event-harness {
            margin-bottom: 2px !important;
        }

        .fc-day-today {
            background: rgba(102, 126, 234, 0.1) !important;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 95%;
            max-width: 600px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            transition: color 0.3s;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            height: 80px;
        }

        .time-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .time-section h4 {
            margin-bottom: 1rem;
            color: #333;
        }

        .date-input {
            margin-bottom: 1rem;
        }

        .ampm-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .ampm-option {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease-in-out;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .ampm-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .ampm-option:hover:not(.selected) {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .time-picker-group {
            display: flex;
            gap: 0.5rem;
        }

        .time-picker-group select {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .share-section {
            border-top: 1px solid #e1e5e9;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
        }

        .share-section h3 {
            color: #333;
            margin-bottom: 1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .event-details {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .event-details h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .event-details p {
            color: #666;
            margin: 0.25rem 0;
        }

        .legend {
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .own-color { background: #667eea; }
        .shared-color { background: #28a745; }
        .all-color { background: #17a2b8; }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 8px;
        }

        .view-option {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .view-option.active {
            background: #667eea;
            color: white;
        }

        .view-option:hover:not(.active) {
            background: white;
        }

        .error-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
            display: none;
        }

        .error-alert.show {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .calendar-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .calendar-header .btn {
                width: 100%;
                text-align: center;
            }
            
            .calendar-container {
                padding: 1rem;
            }
            
            .fc-toolbar {
                flex-direction: column !important;
                gap: 1rem !important;
            }
            
            .fc-toolbar-chunk {
                display: flex !important;
                justify-content: center !important;
            }

            .time-picker-group {
                flex-direction: column;
                gap: 1rem;
            }

            .form-actions {
                flex-direction: column;
            }

            .legend {
                justify-content: center;
            }

            .view-toggle {
                justify-content: center;
            }
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #666;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 0.75rem;
            border-radius: 5px;
            margin: 1rem 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 0.75rem;
            border-radius: 5px;
            margin: 1rem 0;
            border: 1px solid #c3e6cb;
        }

        .admin-section {
            margin-bottom: 2rem;
        }

        .users-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .user-item:hover {
            background: #f8f9fa;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-info-admin {
            flex: 1;
        }

        .user-name {
            font-weight: bold;
            color: #333;
        }

        .user-stats {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .admin-badge {
            background: #ffd700;
            color: #333;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .user-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            border-radius: 4px;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📅 스케줄</h1>
        <div class="user-info">
            <span id="currentUser">게스트</span>
            <button id="adminBtn" class="logout-btn" onclick="openAdminModal()" style="display: none; margin-right: 1rem;">👑 회원관리</button>
            <a href="/logout" class="logout-btn">로그아웃</a>
        </div>
    </div>

    <div class="container">
        <div class="calendar-header">
            <button class="btn btn-primary" onclick="openAddModal()">📝 일정 추가</button>
            <button class="btn btn-success" onclick="refreshCalendar()">🔄 새로고침</button>
            
            <div class="view-toggle">
                <button class="view-option active" onclick="setViewMode('my')" id="myViewBtn">내 일정</button>
                <button class="view-option" onclick="setViewMode('all')" id="allViewBtn">전체 일정</button>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color own-color"></div>
                    <span>내 일정</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color shared-color"></div>
                    <span>공유된 일정</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color all-color"></div>
                    <span>다른 사용자 일정</span>
                </div>
            </div>
        </div>

        <div class="calendar-container">
            <div id="calendar"></div>
        </div>
    </div>

    <!-- 일정 추가 모달 -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addEventModal')">&times;</span>
            <h2>📝 일정 추가</h2>
            <form id="addEventForm">
                
                <div class="form-group">
                    <label for="addDescription">설명 (선택)</label>
                    <textarea id="addDescription" placeholder="일정에 대한 상세 설명"></textarea>
                </div>

                <div class="time-section">
                    <h4>📅 시작 시간</h4>
                    <div class="date-input">
                        <label for="addStartDate">날짜</label>
                        <input type="date" id="addStartDate" required>
                    </div>
                    <div class="ampm-selector">
                        <div class="ampm-option selected" data-time="start" data-ampm="am">오전</div>
                        <div class="ampm-option" data-time="start" data-ampm="pm">오후</div>
                    </div>
                    <div class="time-picker-group">
                        <select id="addStartHour">
                            <option value="1">1시</option>
                            <option value="2">2시</option>
                            <option value="3">3시</option>
                            <option value="4">4시</option>
                            <option value="5">5시</option>
                            <option value="6">6시</option>
                            <option value="7">7시</option>
                            <option value="8">8시</option>
                            <option value="9" selected>9시</option>
                            <option value="10">10시</option>
                            <option value="11">11시</option>
                            <option value="12">12시</option>
                        </select>
                        <select id="addStartMinute">
                            <option value="0" selected>00분</option>
                            <option value="30">30분</option>
                        </select>
                    </div>
                </div>

                <div class="time-section">
                    <h4>⏰ 종료 시간</h4>
                    <div class="date-input" style="display: none;">
                        <label for="addEndDate">날짜</label>
                        <input type="date" id="addEndDate">
                    </div>
                    <div class="time-note">
                        <small style="color: #666; font-style: italic;">
                            💡 종료 시간이 시작 시간보다 이르면 자동으로 다음날로 설정됩니다.
                        </small>
                    </div>
                    <div class="ampm-selector">
                        <div class="ampm-option selected" data-time="end" data-ampm="am">오전</div>
                        <div class="ampm-option" data-time="end" data-ampm="pm">오후</div>
                    </div>
                    <div class="time-picker-group">
                        <select id="addEndHour">
                            <option value="1">1시</option>
                            <option value="2">2시</option>
                            <option value="3">3시</option>
                            <option value="4">4시</option>
                            <option value="5">5시</option>
                            <option value="6">6시</option>
                            <option value="7">7시</option>
                            <option value="8">8시</option>
                            <option value="9">9시</option>
                            <option value="10" selected>10시</option>
                            <option value="11">11시</option>
                            <option value="12">12시</option>
                        </select>
                        <select id="addEndMinute">
                            <option value="0" selected>00분</option>
                            <option value="30">30분</option>
                        </select>
                    </div>
                </div>

                <div id="addConflictAlert" class="error-alert">
                    ⚠️ <span id="addConflictMessage"></span>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="addSubmitBtn">추가</button>
                    <button type="button" class="btn" onclick="closeModal('addEventModal')" style="background: #6c757d; color: white;">취소</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 일정 상세/수정 모달 -->
    <div id="eventDetailModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('eventDetailModal')">&times;</span>
            <h2 id="eventDetailTitle">일정 상세</h2>
            
            <div id="eventDetailView">
                <div class="event-details">
                    <h3 id="detailTitle"></h3>
                    <p><strong>📅 시작:</strong> <span id="detailStartTime"></span></p>
                    <p><strong>⏰ 종료:</strong> <span id="detailEndTime"></span></p>
                    <p><strong>📝 설명:</strong> <span id="detailDescription"></span></p>
                    <p><strong>👤 작성자:</strong> <span id="detailCreator"></span></p>
                </div>
                <div class="form-actions">
                    <button id="editEventBtn" class="btn btn-primary" onclick="switchToEditMode()">수정</button>
                    <button id="shareEventBtn" class="btn btn-success" onclick="showShareSection()">공유</button>
                    <button id="deleteEventBtn" class="btn btn-danger" onclick="deleteCurrentEvent()">삭제</button>
                </div>
            </div>

            <div id="eventEditForm" style="display: none;">
                <form id="eventUpdateForm">
                    <input type="hidden" id="editEventId">
                    <div class="form-group">
                        <label for="editDescription">설명</label>
                        <textarea id="editDescription" placeholder="일정에 대한 상세 설명"></textarea>
                    </div>

                    <div class="time-section">
                        <h4>📅 시작 시간</h4>
                        <div class="date-input">
                            <label for="editStartDate">날짜</label>
                            <input type="date" id="editStartDate" required>
                        </div>
                        <div class="ampm-selector">
                            <div class="ampm-option selected" data-time="editStart" data-ampm="am">오전</div>
                            <div class="ampm-option" data-time="editStart" data-ampm="pm">오후</div>
                        </div>
                        <div class="time-picker-group">
                            <select id="editStartHour">
                                <option value="1">1시</option>
                                <option value="2">2시</option>
                                <option value="3">3시</option>
                                <option value="4">4시</option>
                                <option value="5">5시</option>
                                <option value="6">6시</option>
                                <option value="7">7시</option>
                                <option value="8">8시</option>
                                <option value="9" selected>9시</option>
                                <option value="10">10시</option>
                                <option value="11">11시</option>
                                <option value="12">12시</option>
                            </select>
                            <select id="editStartMinute">
                                <option value="0" selected>00분</option>
                                <option value="30">30분</option>
                            </select>
                        </div>
                    </div>

                    <div class="time-section">
                        <h4>⏰ 종료 시간</h4>
                        <div class="date-input">
                            <label for="editEndDate">날짜</label>
                            <input type="date" id="editEndDate" required>
                        </div>
                        <div class="ampm-selector">
                            <div class="ampm-option" data-time="editEnd" data-ampm="am">오전</div>
                            <div class="ampm-option selected" data-time="editEnd" data-ampm="pm">오후</div>
                        </div>
                        <div class="time-picker-group">
                            <select id="editEndHour">
                                <option value="1">1시</option>
                                <option value="2">2시</option>
                                <option value="3">3시</option>
                                <option value="4">4시</option>
                                <option value="5">5시</option>
                                <option value="6" selected>6시</option>
                                <option value="7">7시</option>
                                <option value="8">8시</option>
                                <option value="9">9시</option>
                                <option value="10">10시</option>
                                <option value="11">11시</option>
                                <option value="12">12시</option>
                            </select>
                            <select id="editEndMinute">
                                <option value="0" selected>00분</option>
                                <option value="30">30분</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="editConflictAlert" class="error-alert">
                        ⚠️ <span id="editConflictMessage"></span>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="editSubmitBtn">저장</button>
                        <button type="button" class="btn" onclick="switchToViewMode()" style="background: #6c757d; color: white;">취소</button>
                    </div>
                </form>
            </div>

            <div id="shareSection" class="share-section" style="display: none;">
                <h3>📤 일정 공유</h3>
                <div class="form-group">
                    <label for="shareUsername">공유할 사용자</label>
                    <select id="shareUsername">
                        <option value="">사용자 선택</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="canEdit">
                        <label for="canEdit">편집 권한 부여</label>
                    </div>
                </div>
                <button type="button" class="btn btn-success" onclick="shareCurrentEvent()">공유하기</button>
            </div>
        </div>
    </div>

    <!-- 관리자 모달 -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('adminModal')">&times;</span>
            <h2>👑 회원 관리</h2>
            
            <div class="admin-section">
                <h3>📊 회원 목록</h3>
                <div id="usersList" class="users-list">
                    <div class="loading">회원 정보를 불러오는 중...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let calendar;
        let currentEvents = [];
        let allEvents = [];
        let currentUsers = [];
        let selectedEvent = null;
        let viewMode = 'my'; // 'my' 또는 'all'
        let startAmPm = 'am';
        let endAmPm = 'am';

        // 날짜 포맷팅 함수들
        function formatDateTime(dateTimeStr) {
            const date = new Date(dateTimeStr);
            return date.toLocaleString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
                timeZone: 'Asia/Seoul'
            });
        }

        function formatDateTimeForInput(dateTimeStr) {
            const date = new Date(dateTimeStr);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // 시간 조합 함수
        function combineDateTime(date, hour, minute, ampm) {
            let actualHour = parseInt(hour);
            if (ampm === 'pm' && actualHour !== 12) {
                actualHour += 12;
            } else if (ampm === 'am' && actualHour === 12) {
                actualHour = 0;
            }
            
            // 로컬 시간대를 명시적으로 처리
            const [year, month, day] = date.split('-').map(Number);
            const dateTime = new Date(year, month - 1, day, actualHour, parseInt(minute));
            return dateTime;
        }

        // 스마트 날짜 시간 조합 함수 (자동 날짜 조정)
        function combineSmartDateTime(startDate, startHour, startMinute, startAmpm, endHour, endMinute, endAmpm) {
            const startTime = combineDateTime(startDate, startHour, startMinute, startAmpm);
            let endTime = combineDateTime(startDate, endHour, endMinute, endAmpm);
            
            // 종료 시간이 시작 시간보다 이르면 다음날로 설정
            if (endTime <= startTime) {
                endTime.setDate(endTime.getDate() + 1);
            }
            
            return { startTime, endTime };
        }

        // 시간 중복 확인 함수
        function checkTimeConflict(startTime, endTime, excludeEventId = null) {
            const conflicts = [];
            const newStart = new Date(startTime);
            const newEnd = new Date(endTime);
            
            const eventsToCheck = viewMode === 'all' ? allEvents : currentEvents;
            
            eventsToCheck.forEach(event => {
                if (excludeEventId && event.id == excludeEventId) return;
                
                const eventStart = new Date(event.start_time);
                const eventEnd = new Date(event.end_time);
                
                if (newStart < eventEnd && newEnd > eventStart) {
                    conflicts.push(event);
                }
            });
            
            return conflicts;
        }

        // 중복 검사 및 UI 업데이트
        function updateAddFormConflictStatus() {
            const startDate = document.getElementById('addStartDate').value;
            const startHour = document.getElementById('addStartHour').value;
            const startMinute = document.getElementById('addStartMinute').value;
            const endHour = document.getElementById('addEndHour').value;
            const endMinute = document.getElementById('addEndMinute').value;
            
            if (!startDate) return;
            
            const { startTime, endTime } = combineSmartDateTime(startDate, startHour, startMinute, startAmPm, endHour, endMinute, endAmPm);
            
            const alertElement = document.getElementById('addConflictAlert');
            const messageElement = document.getElementById('addConflictMessage');
            const submitBtn = document.getElementById('addSubmitBtn');
            
            const conflicts = checkTimeConflict(startTime, endTime);
            
            if (conflicts.length > 0) {
                const conflictTitles = conflicts.map(c => `"${c.title}"`).join(', ');
                messageElement.textContent = `다음 일정과 시간이 겹칩니다: ${conflictTitles}`;
                alertElement.classList.add('show');
                submitBtn.disabled = true;
            } else {
                alertElement.classList.remove('show');
                submitBtn.disabled = false;
            }
        }

        // 오전/오후 선택 이벤트 설정
        function setupTimeSelectors() {
            document.querySelectorAll('.ampm-option').forEach(option => {
                option.addEventListener('click', function() {
                    const timeType = this.dataset.time;
                    const ampm = this.dataset.ampm;
                    
                    // 같은 시간대의 다른 옵션들 선택 해제
                    document.querySelectorAll(`.ampm-option[data-time="${timeType}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // 현재 옵션 선택
                    this.classList.add('selected');
                    
                    // 전역 변수 업데이트
                    if (timeType === 'start') {
                        startAmPm = ampm;
                        updateAddFormConflictStatus();
                    } else if (timeType === 'end') {
                        endAmPm = ampm;
                        updateAddFormConflictStatus();
                    }
                    // editStart, editEnd는 전역 변수 업데이트 불필요 (로컬에서 처리)
                });
            });

            // 시간/분 변경 감지
            ['addStartHour', 'addStartMinute', 'addEndHour', 'addEndMinute', 'addStartDate'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateAddFormConflictStatus);
            });
        }

        // 뷰 모드 설정
        function setViewMode(mode) {
            viewMode = mode;
            
            // 버튼 상태 업데이트
            document.querySelectorAll('.view-option').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode === 'my' ? 'myViewBtn' : 'allViewBtn').classList.add('active');
            
            // 달력 업데이트
            refreshCalendar();
        }

        // 모달 관리 함수들
        function openAddModal(dateStr = null) {
            const modal = document.getElementById('addEventModal');
            
            const today = dateStr || new Date().toISOString().split('T')[0];
            document.getElementById('addStartDate').value = today;
            // 종료 날짜는 자동으로 계산되므로 설정하지 않음
            
            // 시간 초기화
            document.getElementById('addStartHour').value = '9';
            document.getElementById('addStartMinute').value = '0';
            document.getElementById('addEndHour').value = '10';
            document.getElementById('addEndMinute').value = '0';
            
            // 오전/오후 초기화
            document.querySelectorAll('.ampm-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.ampm-option[data-ampm="am"]').forEach(opt => opt.classList.add('selected'));
            startAmPm = 'am';
            endAmPm = 'am';
            
            // 폼 리셋
            document.getElementById('addDescription').value = '';
            document.getElementById('addConflictAlert').classList.remove('show');
            document.getElementById('addSubmitBtn').disabled = false;
            
            modal.style.display = 'block';
            updateAddFormConflictStatus();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'eventDetailModal') {
                switchToViewMode();
                document.getElementById('shareSection').style.display = 'none';
            }
        }

        function switchToEditMode() {
            document.getElementById('eventDetailView').style.display = 'none';
            document.getElementById('eventEditForm').style.display = 'block';
            document.getElementById('eventDetailTitle').textContent = '일정 수정';
        }

        function switchToViewMode() {
            document.getElementById('eventEditForm').style.display = 'none';
            document.getElementById('eventDetailView').style.display = 'block';
            document.getElementById('eventDetailTitle').textContent = '일정 상세';
        }

        function showShareSection() {
            const shareSection = document.getElementById('shareSection');
            shareSection.style.display = shareSection.style.display === 'none' ? 'block' : 'none';
            if (shareSection.style.display === 'block') {
                loadUsers();
            }
        }

        // 데이터 로딩 함수들
        async function loadEvents() {
            try {
                const response = await fetch('/api/events');
                const events = await response.json();
                currentEvents = events;
                return events;
            } catch (error) {
                console.error('내 일정 로드 실패:', error);
                return [];
            }
        }

        async function loadAllEvents() {
            try {
                const response = await fetch('/api/events/all');
                const events = await response.json();
                allEvents = events;
                return events;
            } catch (error) {
                console.error('전체 일정 로드 실패:', error);
                return [];
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                const users = await response.json();
                currentUsers = users;
                
                const select = document.getElementById('shareUsername');
                select.innerHTML = '<option value="">사용자 선택</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.username;
                    option.textContent = user.username;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('사용자 목록 로드 실패:', error);
            }
        }

        // 달력 초기화
        function initializeCalendar() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                timeZone: 'local',
                height: 'auto',
                nextDayThreshold: '00:00:00',  // 자정 이후 일정을 다음날로 연결하지 않음
                displayEventEnd: false,  // 종료 시간 표시하지 않음 (다음날 연결 방지)
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: '오늘',
                    month: '월',
                    week: '주',
                    day: '일'
                },
                eventClick: function(info) {
                    showEventDetail(info.event.extendedProps.originalEvent);
                },
                dateClick: function(info) {
                    openAddModal(info.dateStr);
                },
                eventDidMount: function(info) {
                    const start = new Date(info.event.start).toLocaleTimeString('ko-KR', {
                        hour: '2-digit', 
                        minute:'2-digit',
                        hour12: true,
                        timeZone: 'Asia/Seoul'
                    });
                    const end = new Date(info.event.end).toLocaleTimeString('ko-KR', {
                        hour: '2-digit', 
                        minute:'2-digit',
                        hour12: true,
                        timeZone: 'Asia/Seoul'
                    });
                    info.el.title = `${info.event.title}\n${start} - ${end}\n작성자: ${info.event.extendedProps.creator}`;
                }
            });
            
            calendar.render();
        }

        // 달력 새로고침
        async function refreshCalendar() {
            let events = [];
            
            if (viewMode === 'my') {
                events = await loadEvents();
            } else {
                events = await loadAllEvents();
            }
            
            const calendarEvents = events.map(event => {
                let className = 'all-event';
                if (viewMode === 'my') {
                    className = event.is_owner ? 'own-event' : 'shared-event';
                }
                
                // 일정이 다음날로 넘어가는 경우 시작 날짜에만 표시
                const startDate = new Date(event.start_time);
                const endDate = new Date(event.end_time);
                
                let displayEnd = event.end_time;
                if (startDate.toDateString() !== endDate.toDateString()) {
                    // 다음날로 넘어가는 경우 시작 날짜의 23:59:59로 제한
                    const sameDay = new Date(startDate);
                    sameDay.setHours(23, 59, 59, 999);
                    displayEnd = sameDay.toISOString();
                }
                
                return {
                    id: event.id,
                    title: event.title,
                    start: event.start_time,
                    end: displayEnd,
                    description: event.description,
                    extendedProps: {
                        creator: event.creator,
                        isOwner: event.is_owner,
                        originalEvent: event
                    },
                    className: className
                };
            });

            if (calendar) {
                calendar.removeAllEvents();
                calendar.addEventSource(calendarEvents);
            }
        }

        // 일정 상세 표시
        function showEventDetail(event) {
            selectedEvent = event;
            
            document.getElementById('detailTitle').textContent = event.title;
            document.getElementById('detailDescription').textContent = event.description || '설명 없음';
            document.getElementById('detailStartTime').textContent = formatDateTime(event.start_time);
            document.getElementById('detailEndTime').textContent = formatDateTime(event.end_time);
            document.getElementById('detailCreator').textContent = event.creator;
            
            // 편집 폼에 데이터 설정
            document.getElementById('editEventId').value = event.id;
            document.getElementById('editDescription').value = event.description || '';
            
            // 시작 시간 설정
            const startDate = new Date(event.start_time);
            const startYear = startDate.getFullYear();
            const startMonth = String(startDate.getMonth() + 1).padStart(2, '0');
            const startDay = String(startDate.getDate()).padStart(2, '0');
            document.getElementById('editStartDate').value = `${startYear}-${startMonth}-${startDay}`;
            
            let startHour = startDate.getHours();
            let startAmPm = 'am';
            if (startHour === 0) {
                startHour = 12;
            } else if (startHour > 12) {
                startHour -= 12;
                startAmPm = 'pm';
            } else if (startHour === 12) {
                startAmPm = 'pm';
            }
            
            document.getElementById('editStartHour').value = startHour;
            document.getElementById('editStartMinute').value = startDate.getMinutes();
            
            // 시작 시간 오전/오후 버튼 설정
            document.querySelectorAll('[data-time="editStart"]').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.ampm === startAmPm) {
                    btn.classList.add('selected');
                }
            });
            
            // 종료 시간 설정
            const endDate = new Date(event.end_time);
            const endYear = endDate.getFullYear();
            const endMonth = String(endDate.getMonth() + 1).padStart(2, '0');
            const endDay = String(endDate.getDate()).padStart(2, '0');
            document.getElementById('editEndDate').value = `${endYear}-${endMonth}-${endDay}`;
            
            let endHour = endDate.getHours();
            let endAmPm = 'am';
            if (endHour === 0) {
                endHour = 12;
            } else if (endHour > 12) {
                endHour -= 12;
                endAmPm = 'pm';
            } else if (endHour === 12) {
                endAmPm = 'pm';
            }
            
            document.getElementById('editEndHour').value = endHour;
            document.getElementById('editEndMinute').value = endDate.getMinutes();
            
            // 종료 시간 오전/오후 버튼 설정
            document.querySelectorAll('[data-time="editEnd"]').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.ampm === endAmPm) {
                    btn.classList.add('selected');
                }
            });
            
            // 버튼 표시/숨김 (관리자이거나 내 일정인 경우 편집 가능)
            const canEdit = isAdmin || (event.is_owner && viewMode === 'my');
            const canShare = event.is_owner && viewMode === 'my'; // 공유는 본인 일정만
            document.getElementById('editEventBtn').style.display = canEdit ? 'inline-block' : 'none';
            document.getElementById('shareEventBtn').style.display = canShare ? 'inline-block' : 'none';
            document.getElementById('deleteEventBtn').style.display = canEdit ? 'inline-block' : 'none';
            
            document.getElementById('eventDetailModal').style.display = 'block';
        }

        // 일정 관리 함수들
        async function createEvent(eventData) {
            try {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                if (response.ok) {
                    showMessage('일정이 추가되었습니다!', 'success');
                    refreshCalendar();
                    return true;
                } else {
                    const error = await response.json();
                    showMessage(error.error || '일정 추가에 실패했습니다.', 'error');
                    return false;
                }
            } catch (error) {
                console.error('일정 추가 실패:', error);
                showMessage('일정 추가 중 오류가 발생했습니다.', 'error');
                return false;
            }
        }

        async function updateEvent(eventData) {
            try {
                const response = await fetch(`/api/events/${eventData.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                if (response.ok) {
                    showMessage('일정이 수정되었습니다!', 'success');
                    refreshCalendar();
                    closeModal('eventDetailModal');
                    return true;
                } else {
                    const error = await response.json();
                    showMessage(error.error || '일정 수정에 실패했습니다.', 'error');
                    return false;
                }
            } catch (error) {
                console.error('일정 수정 실패:', error);
                showMessage('일정 수정 중 오류가 발생했습니다.', 'error');
                return false;
            }
        }

        async function deleteCurrentEvent() {
            if (!selectedEvent || !confirm('이 일정을 삭제하시겠습니까?')) return;

            try {
                const response = await fetch(`/api/events/${selectedEvent.id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('일정이 삭제되었습니다.', 'success');
                    refreshCalendar();
                    closeModal('eventDetailModal');
                } else {
                    showMessage('일정 삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('일정 삭제 실패:', error);
                showMessage('일정 삭제 중 오류가 발생했습니다.', 'error');
            }
        }

        async function shareCurrentEvent() {
            if (!selectedEvent) return;
            
            const username = document.getElementById('shareUsername').value;
            const canEdit = document.getElementById('canEdit').checked;
            
            if (!username) {
                showMessage('공유할 사용자를 선택해주세요.', 'error');
                return;
            }

            try {
                const response = await fetch('/api/share', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        event_id: selectedEvent.id,
                        username: username,
                        can_edit: canEdit
                    })
                });

                const result = await response.json();
                
                if (response.ok && result.success) {
                    showMessage('일정이 성공적으로 공유되었습니다!', 'success');
                    document.getElementById('shareUsername').value = '';
                    document.getElementById('canEdit').checked = false;
                    document.getElementById('shareSection').style.display = 'none';
                } else {
                    showMessage(result.error || '일정 공유에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('일정 공유 실패:', error);
                showMessage('일정 공유 중 오류가 발생했습니다.', 'error');
            }
        }

        function showMessage(message, type = 'info') {
            const existingMessage = document.querySelector('.message-toast');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageEl = document.createElement('div');
            messageEl.className = `message-toast ${type === 'error' ? 'error-message' : 'success-message'}`;
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                max-width: 400px;
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 3000);
        }

        // 이벤트 리스너들
        document.getElementById('addEventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const startDate = document.getElementById('addStartDate').value;
            const startHour = document.getElementById('addStartHour').value;
            const startMinute = document.getElementById('addStartMinute').value;
            const endHour = document.getElementById('addEndHour').value;
            const endMinute = document.getElementById('addEndMinute').value;
            
            const { startTime, endTime } = combineSmartDateTime(startDate, startHour, startMinute, startAmPm, endHour, endMinute, endAmPm);
            
            console.log('시간 입력 값:', {
                startDate, startHour, startMinute, startAmPm,
                endHour, endMinute, endAmPm
            });
            console.log('변환된 시간:', {
                startTime: startTime.toString(),
                endTime: endTime.toString()
            });
            
            // 로컬 시간대 오프셋을 고려한 ISO 문자열 생성
            function toLocalISOString(date) {
                const offset = date.getTimezoneOffset();
                const localDate = new Date(date.getTime() - offset * 60000);
                return localDate.toISOString();
            }
            
            // 현재 사용자 이름을 제목으로 사용
            const currentUsername = document.getElementById('currentUser').textContent.replace('님', '');
            
            const eventData = {
                title: currentUsername,
                description: document.getElementById('addDescription').value,
                start_time: toLocalISOString(startTime),
                end_time: toLocalISOString(endTime)
            };
            
            const success = await createEvent(eventData);
            if (success) {
                closeModal('addEventModal');
                document.getElementById('addEventForm').reset();
            }
        });

        document.getElementById('eventUpdateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const editStartDate = document.getElementById('editStartDate').value;
            const editStartHour = document.getElementById('editStartHour').value;
            const editStartMinute = document.getElementById('editStartMinute').value;
            const editEndDate = document.getElementById('editEndDate').value;
            const editEndHour = document.getElementById('editEndHour').value;
            const editEndMinute = document.getElementById('editEndMinute').value;
            
            // 현재 선택된 오전/오후 확인
            const editStartAmPm = document.querySelector('[data-time="editStart"].selected').dataset.ampm;
            const editEndAmPm = document.querySelector('[data-time="editEnd"].selected').dataset.ampm;
            
            const editStartTime = combineDateTime(editStartDate, editStartHour, editStartMinute, editStartAmPm);
            const editEndTime = combineDateTime(editEndDate, editEndHour, editEndMinute, editEndAmPm);
            
            // 로컬 시간대 오프셋을 고려한 ISO 문자열 생성
            function toLocalISOString(date) {
                const offset = date.getTimezoneOffset();
                const localDate = new Date(date.getTime() - offset * 60000);
                return localDate.toISOString();
            }
            
            // 현재 사용자 이름을 제목으로 사용
            const currentUsername = document.getElementById('currentUser').textContent.replace('님', '');
            
            const eventData = {
                id: document.getElementById('editEventId').value,
                title: currentUsername,
                description: document.getElementById('editDescription').value,
                start_time: toLocalISOString(editStartTime),
                end_time: toLocalISOString(editEndTime)
            };
            
            const success = await updateEvent(eventData);
            if (success) {
                switchToViewMode();
            }
        });

        // 모달 외부 클릭시 닫기
        window.onclick = function(event) {
            const addModal = document.getElementById('addEventModal');
            const detailModal = document.getElementById('eventDetailModal');
            const adminModal = document.getElementById('adminModal');
            
            if (event.target === addModal) {
                closeModal('addEventModal');
            } else if (event.target === detailModal) {
                closeModal('eventDetailModal');
            } else if (event.target === adminModal) {
                closeModal('adminModal');
            }
        }

        // 관리자 관련 함수들
        let isAdmin = false;
        let allUsers = [];


        async function loadAllUsers() {
            try {
                const response = await fetch('/api/admin/users');
                if (response.ok) {
                    allUsers = await response.json();
                    displayUsers();
                } else {
                    showMessage('사용자 목록을 불러올 수 없습니다.', 'error');
                }
            } catch (error) {
                showMessage('서버 오류가 발생했습니다.', 'error');
            }
        }

        function displayUsers() {
            const usersList = document.getElementById('usersList');
            
            if (allUsers.length === 0) {
                usersList.innerHTML = '<div class="loading">등록된 사용자가 없습니다.</div>';
                return;
            }

            const usersHTML = allUsers.map(user => `
                <div class="user-item">
                    <div class="user-info-admin">
                        <div class="user-name">
                            ${user.username}
                            ${user.is_admin ? '<span class="admin-badge">👑 관리자</span>' : ''}
                        </div>
                        <div class="user-stats">
                            가입일: ${new Date(user.created_at).toLocaleDateString('ko-KR')} | 
                            일정 수: ${user.event_count}개
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-info btn-small" onclick="changeUsername(${user.id}, '${user.username}')">
                            ✏️ 이름 변경
                        </button>
                        <button class="btn btn-primary btn-small" onclick="changeUserPassword(${user.id}, '${user.username}')">
                            🔒 비밀번호 변경
                        </button>
                        ${!user.is_admin ? `
                            <button class="btn btn-danger btn-small" onclick="deleteUser(${user.id}, '${user.username}')">
                                삭제
                            </button>
                        ` : '<span style="color: #666;">삭제 불가</span>'}
                    </div>
                </div>
            `).join('');

            usersList.innerHTML = usersHTML;
        }

        async function changeUsername(userId, currentUsername) {
            const newUsername = prompt(`${currentUsername}의 새 사용자명을 입력하세요:`, currentUsername);
            if (!newUsername || newUsername === currentUsername) {
                return;
            }

            if (newUsername.length < 1) {
                alert('사용자명을 입력해주세요.');
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}/username`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        new_username: newUsername
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showMessage(result.message, 'success');
                    loadAllUsers(); // 사용자 목록 새로고침
                    refreshCalendar(); // 달력도 새로고침 (이름이 바뀌었으므로)
                } else {
                    const result = await response.json();
                    showMessage(result.error || '사용자명 변경에 실패했습니다.', 'error');
                }
            } catch (error) {
                showMessage('서버 오류가 발생했습니다.', 'error');
            }
        }

        async function changeUserPassword(userId, username) {
            const newPassword = prompt(`${username}의 새 비밀번호를 입력하세요:`);
            if (!newPassword) {
                return;
            }

            if (newPassword.length < 1) {
                alert('비밀번호를 입력해주세요.');
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}/password`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        new_password: newPassword
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showMessage(result.message, 'success');
                } else {
                    const result = await response.json();
                    showMessage(result.error || '비밀번호 변경에 실패했습니다.', 'error');
                }
            } catch (error) {
                showMessage('서버 오류가 발생했습니다.', 'error');
            }
        }

        async function deleteUser(userId, username) {
            if (!confirm(`정말로 "${username}" 사용자를 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없으며, 해당 사용자의 모든 일정도 함께 삭제됩니다.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage(`"${username}" 사용자가 삭제되었습니다.`, 'success');
                    loadAllUsers(); // 목록 새로고침
                    refreshCalendar(); // 달력 새로고침
                } else {
                    const error = await response.json();
                    showMessage(error.error || '사용자 삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                showMessage('서버 오류가 발생했습니다.', 'error');
            }
        }

        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'block';
            loadAllUsers();
        }

        // 사용자 정보 표시
        async function displayCurrentUser() {
            const currentUserElement = document.getElementById('currentUser');
            
            try {
                const response = await fetch('/api/current-user');
                if (response.ok) {
                    const userData = await response.json();
                    currentUserElement.textContent = userData.username + '님';
                    
                    // 관리자인 경우 배지 추가
                    if (userData.is_admin) {
                        currentUserElement.innerHTML += ' <span class="admin-badge">👑 관리자</span>';
                        document.getElementById('adminBtn').style.display = 'inline-block';
                        isAdmin = true;
                    }
                } else {
                    currentUserElement.textContent = '게스트';
                }
            } catch (error) {
                console.error('사용자 정보 로드 실패:', error);
                currentUserElement.textContent = '게스트';
            }
        }

        // 초기화
        window.onload = function() {
            displayCurrentUser();
            initializeCalendar();
            setupTimeSelectors();
            refreshCalendar();
        };

        // CSS 애니메이션 추가
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>